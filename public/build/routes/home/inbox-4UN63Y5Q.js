import{a as g,b as x}from"/build/_shared/chunk-MNPIC26H.js";import{a as w,k as y}from"/build/_shared/chunk-WLPYV2BQ.js";import{c as h,d as C,e as N}from"/build/_shared/chunk-7UEYUE33.js";var o=h(C());var e=h(N());var I=()=>{let a=y(),r=a.user.id,[d,f]=(0,o.useState)([]),[l,m]=(0,o.useState)([]),[n,p]=(0,o.useState)(),v=async()=>{let t={search:{fromToUser:o.useId}},s=await g.post(`${x}/api/search-chat`,t);if(s.data.status==!0)for(let i=0;i<s.data.data.length;i++){let c=s.data.data[i].fromUser.id,u=s.data.data[i].toUser.id;c==r&&(d.includes(u)||(f([...d,u]),m([...l,s.data.data[i]]))),u==r&&(d.includes(c)||(f([...d,c]),m([...l,s.data.data[i]])))}};return(0,o.useEffect)(()=>{v()}),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("div",{className:"my-4",children:(0,e.jsxs)("div",{className:"flex gap-4 flex-col xl:flex-row",children:[(0,e.jsxs)("div",{className:"w-full flex lg:flex-row flex-col gap-4",children:[(0,e.jsx)("div",{className:"w-full bg-white rounded-lg shadow-xl lg:w-80 p-2 max-h-screen overflow-y-scroll no-scrollbar min-h-screen",children:l.map((t,s)=>(0,e.jsx)("div",{onClick:()=>{p({name:t.fromUser.id==r?t.toUser.name.toString().split("@")[0]:t.fromUser.name.toString().split("@")[0],avatar:t.fromUser.id==r?t.toUser.pic:t.fromUser.pic,userid:t.fromUser.id==r?t.toUser.id:t.fromUser.id,index:s.toString()})},children:(0,e.jsx)(M,{active:(n==null?void 0:n.index)==s.toString(),name:t.fromUser.id==r?t.toUser.name.toString().split("@")[0]:t.fromUser.name.toString().split("@")[0],message:`${t.fromUser.id==r?"you: ":""} ${t.comment}`,url:t.fromUser.id==r?t.toUser.pic:t.fromUser.pic})},s))}),n!=null?(0,e.jsx)(k,{avatar:n.avatar,id:n.userid,userId:r,name:n.name,useravatar:a.user.pic}):null]}),n!=null?(0,e.jsx)(T,{id:n.userid}):null]})})})},A=I,M=a=>(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:`flex w-full py-2 my-1 border-b-2 rounded-md ${a.active?"bg-gray-200 px-4":"border-slate-200"}`,children:[(0,e.jsx)("img",{src:a.url,alt:"user images",className:"w-10 h-10 object-cover rounded-lg shrink-0"}),(0,e.jsx)("div",{className:"w-2"}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-md font-medium  leading-none text-slate-800",children:a.name}),(0,e.jsx)("p",{className:"text-sm font-normal leading-none text-slate-600",children:a.message})]})]})}),$=a=>(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"w-full flex items-start my-4",children:[(0,e.jsx)("div",{className:`grow ${a.user?"":"hidden"}`}),(0,e.jsx)("img",{src:a.avatar,alt:"avatar",className:`w-10 h-10 rounded-md ${a.user?"order-3":""}`}),(0,e.jsx)("div",{className:`w-4 ${a.user?"order-2":""}`}),(0,e.jsxs)("div",{className:"max-w-4/5 bg-gray-200 rounded-md p-2 order-1",children:[(0,e.jsx)("p",{className:`text-xs text-gray-700 font-normal ${a.user?"text-right":"text-left"}`,children:a.time}),(0,e.jsx)("p",{className:`text-md text-gray-900 font-normal text-left ${a.user?"text-right":"text-left"}`,children:a.message})]})]})}),T=a=>{let[r,d]=(0,o.useState)(null),f=async()=>{let m=await g({method:"post",url:`${x}/api/getuser`,data:{id:a.id}});m.data.status==!0&&d(m.data.data[0])};(0,o.useEffect)(()=>{f()},[]);let l=w();return(0,e.jsx)(e.Fragment,{children:r==null?(0,e.jsx)("div",{className:"bg-white rounded-lg shadow-xl",children:(0,e.jsx)("h1",{className:"text-center font-semibold text-rose-500 p-4",children:"No user found"})}):(0,e.jsxs)("div",{className:"bg-white rounded-lg shadow-xl flex w-full xl:w-80 xl:flex-col flex-col sm:flex-row items-start p-4 xl:px-0 xl:pt-0",children:[(0,e.jsx)("div",{className:"w-80 h-80 shrink-0 mx-auto",children:(0,e.jsx)("img",{src:r.pic,alt:"error",className:"w-full h-80 object-cover rounded-lg"})}),(0,e.jsxs)("div",{className:"px-4 mt-6 sm:mt-0 grow w-full",children:[(0,e.jsx)("p",{className:"text-left font-semibold text-lg text-slate-800",children:r.userName.toString().split("@")[0]}),(0,e.jsx)("p",{className:"text-left font-semibold text-sm text-slate-600 mt-4",children:"Bio"}),(0,e.jsx)("p",{className:"text-left font-normal text-sm text-slate-600 mt-4",children:r.bio}),(0,e.jsx)("button",{onClick:()=>{l("/home/branduser")},className:" mt-2 w-full py-2 text-center text-primary font-semibold text-lg bg-[#01FFF4] rounded-md",children:"View profile"}),(0,e.jsx)("div",{className:"h-[1px] bg-slate-400 my-4 w-full"})]})]})})},k=a=>{let r=(0,o.useRef)(null),d=(0,o.useRef)(null),[f,l]=(0,o.useState)([]),[m,n]=(0,o.useState)(!1),p=async()=>{l([]);let t={search:{fromUser:a.id,toUser:a.userId}},s={search:{fromUser:a.userId,toUser:a.id}},i=await g({method:"post",url:`${x}/api/search-chat`,data:t}),c=await g({method:"post",url:`${x}/api/search-chat`,data:s});l(u=>[...u,...i.data.data,...c.data.data]),l(u=>u.sort((U,b)=>new Date(b.updatedAt).getTime()-new Date(U.updatedAt).getTime()))};(0,o.useEffect)(()=>{var t;r.current.scrollTop=(t=r.current)==null?void 0:t.scrollHeight,p()},[m]);let v=async t=>{let s={campaignDraftId:"0",fromUserId:a.userId,toUserId:a.id,comment:t},i=await g({method:"post",url:`${x}/api/add-chat`,data:s,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*","Access-Control-Allow-Options":"*","Access-Control-Allow-Methods":"*","X-Content-Type-Options":"*","Content-Type":"application/json",Accept:"*"}});n(!m)};return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full p-4 max-h-screen flex flex-col",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("img",{src:a.avatar,className:"w-10 h-10 rounded-md",alt:"avatar"}),(0,e.jsx)("div",{className:"w-4"}),(0,e.jsx)("p",{className:"text-md font-semibold text-slate-900 ",children:a.name})]}),(0,e.jsx)("div",{className:"w-full h-[2px] my-2 bg-slate-300"}),(0,e.jsx)("div",{ref:r,className:"w-full h-full overflow-y-scroll grow no-scrollbar",children:f.reverse().map((t,s)=>(0,e.jsx)("div",{children:(0,e.jsx)($,{avatar:t.fromUser.id==a.userId?a.useravatar:a.avatar,message:t.comment,time:t.updatedAt,user:t.fromUser.id==a.userId})},s))}),(0,e.jsx)("div",{className:"w-full px-4 py-2",children:(0,e.jsxs)("div",{className:" bg-gray-200 rounded-md px-2 py-2 flex",children:[(0,e.jsx)("input",{ref:d,type:"text",className:"py-1 w-full px-2 bg-transparent outline-none",placeholder:"type something"}),(0,e.jsx)("div",{className:"w-4"}),(0,e.jsx)("button",{className:"bg-primary rounded-md text-white  text-md py-1 px-4 font-semibold",onClick:async()=>{var t,s,i,c;((t=d.current)==null?void 0:t.value)==null||((s=d.current)==null?void 0:s.value)==null||((i=d.current)==null?void 0:i.value)==""||(await v((c=d.current)==null?void 0:c.value),d.current.value="")},children:"SEND"})]})})]})})};export{A as default};
